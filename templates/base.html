{% load static %}
<!DOCTYPE HTML>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="pragma" content="no-cache" />
  <meta http-equiv="cache-control" content="max-age=604800" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>TechBazaar | Your Trusted Online Shopping Platform for Electronic Gadgets</title>

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

  <!-- TailwindCSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Feather icons CDN -->
  <script src="https://unpkg.com/feather-icons"></script>

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400&display=swap" rel="stylesheet">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  

  <script type="text/javascript">
    $(document).ready(function() {
      // Example: Thumbnail image swap
      $(document).on('click', '.thumb a', function(e){
        e.preventDefault();
        var newSrc = $(this).data('src') || $(this).attr('href');
        $('.mainImage img').attr('src', newSrc);
      });
    });
  </script>
</head>
<body>

  <!-- navbar -->
  {% include 'includes/navbar.html' %}

  {% block content %}
  <!-- page content -->
  {% endblock %}

   <!-- footer -->
   {% include 'includes/footer.html' %}



<!-- Chatbot Begin -->

<!-- Floating Chatbot Button -->
<div id="chatbot" class="fixed bottom-5 right-5 w-14 h-14 sm:w-16 sm:h-16 rounded-full bg-gradient-to-br from-teal-500 to-teal-700 shadow-lg flex items-center justify-center cursor-pointer z-50 transition-transform duration-200">
    <i id="chatbot-icon" class="fa fa-comments text-white text-lg sm:text-xl"></i>
</div>

<style>
  /* Ultra-small screens: shrink chatbot button and icon */
  @media (max-width: 400px) {
    #chatbot {
      width: 50px !important;
      height: 50px !important;
    }
    #chatbot-icon {
      font-size: 18px !important;
    }
  }
</style>


<!-- Chatbot Panel -->
<div id="chatbot-panel" class="fixed bottom-20 right-5 w-72 sm:w-80 max-h-[400px] sm:max-h-[500px] rounded-xl bg-white shadow-lg flex-col overflow-hidden font-sans text-sm sm:text-base hidden z-50">
    <!-- Header -->
        <div style="
        background: linear-gradient(135deg, #17a2b8, #138496);
        color: #fff;
        padding: 12px 15px;
        font-weight: bold;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 16px;
    ">
        TechBazaar Help
        <div class="flex gap-3 sm:gap-4"> <!-- adjust gap for small screens -->
            <!-- Back to root icon -->
            <i id="chatbot-back" class="fa fa-arrow-left cursor-pointer text-base sm:text-lg" title="Back to root"></i>

            <!-- Clear chat icon -->
            <i id="chatbot-clear" class="fa fa-broom cursor-pointer text-base sm:text-lg" title="Clear chat"></i>
        </div>
    </div>

    <!-- Options -->
    <div id="chatbot-options" class="flex-1 overflow-y-auto p-2 sm:p-3 bg-gray-50 text-xs sm:text-sm"></div>

    <!-- Messages -->
    <div id="chatbot-messages" class="flex flex-col gap-1 sm:gap-2 p-2 sm:p-3 overflow-y-auto max-h-[140px] sm:max-h-[180px] border-t border-gray-200 bg-white text-xs sm:text-sm"></div>
</div>

<!-- Chatbot Script -->
<script>
    const chatbot = document.getElementById('chatbot');
    const panel = document.getElementById('chatbot-panel');
    const messages = document.getElementById('chatbot-messages');
    const options = document.getElementById('chatbot-options');
    const clearBtn = document.getElementById('chatbot-clear');
    const backBtn = document.getElementById('chatbot-back');

    // Hover scale effect
    chatbot.addEventListener('mouseenter', () => chatbot.style.transform = 'scale(1.1)');
    chatbot.addEventListener('mouseleave', () => chatbot.style.transform = 'scale(1)');

    // Toggle panel
    chatbot.addEventListener('click', () => {
        panel.classList.toggle('hidden');
        if (!panel.classList.contains('hidden')) renderOptions(faqTree);
    });

    // Clear chat
    clearBtn.addEventListener('click', () => messages.innerHTML = '');

    // Back to root
    backBtn.addEventListener('click', () => renderOptions(faqTree));

    const faqTree = [
        { question: "Shipping & Delivery", children: [
            { question: "What are your shipping charges?", answer: "Shipping is free for orders over Tk 5000. Otherwise Tk 150." },
            { question: "How long does delivery take?", answer: "Delivery usually takes 2-5 business days within Bangladesh." },
            { question: "Do you ship internationally?", answer: "Currently, we only ship within Bangladesh." },
            { question: "Can I change my shipping address?", answer: "Yes, before the order is dispatched, contact support to change the address." }
        ]},
        { question: "Warranty & Returns", children: [
            { question: "Do you provide warranty?", answer: "Yes, all products come with manufacturer warranty." },
            { question: "How can I return an item?", answer: "You can return items within 7 days of delivery. Contact support to start the process." },
            { question: "What if my product is damaged?", answer: "Contact support immediately, and we will assist with replacement or refund." }
        ]},
        { question: "Orders & Support", children: [
            { question: "Can I cancel my order?", answer: "Yes, cancel before shipment. Contact support to cancel." },
            { question: "Can I modify my order?", answer: "Only before dispatch. Contact support for changes." },
            { question: "What if I receive a wrong product?", answer: "Contact support immediately for a replacement or refund." }
        ]},
        { question: "Payments", children: [
            { question: "What payment methods do you accept?", answer: "We accept bKash, Rocket, Nagad, Upay, VisaCard, MasterCard and DBBL Nexus Card." },
            { question: "Is online payment secure?", answer: "Yes, all payments are encrypted and secure." },
            { question: "Can I pay on delivery?", answer: "Currently, Cash on Delivery is not available; please use online payment methods." }
        ]},
        { question: "Products", children: [
            { question: "Do you have smartphones?", answer: "Yes, we have a variety of smartphones from popular brands."  },
            { question: "Do you sell laptops?", answer: "Yes, laptops from multiple brands are available." },
            { question: "Do you sell accessories?", answer: "Yes, keyboards, mice, headphones, speakers, tablets, and more." },
            { question: "Are your products genuine?", answer: "Yes, we sell only genuine, brand new products." }
        ]}
    ];

    function renderOptions(tree) {
        options.innerHTML = '';
        tree.forEach(item => {
            const btn = document.createElement('button');
            btn.textContent = item.question;
            btn.className = 'w-full mb-1 sm:mb-2 px-2 sm:px-3 py-1 sm:py-2 rounded bg-white text-left shadow-sm hover:bg-blue-50 hover:translate-x-1 transition';
            btn.addEventListener('click', () => handleClick(item));
            options.appendChild(btn);
        });
    }

    // Handle Q&A with chat bubble styling
    function handleClick(node) {
        if(node.answer) {
            // User message (right side bubble)
            messages.innerHTML += `
                <div style="text-align: right;">
                    <span style="
                        display: inline-block;
                        background: #17a2b8;
                        color: #fff;
                        padding: 6px 10px; /* smaller padding for user message */
                        border-radius: 15px 15px 0 15px;
                        max-width: 80%;
                        text-align: left;
                        margin-bottom: 6px;
                        font-size: 0.875rem; /* scale for smaller screens */
                    ">${node.question}</span>
                </div>
            `;
            messages.scrollTop = messages.scrollHeight;

            // Bot reply after delay (left side bubble remains unchanged)
            setTimeout(() => {
                messages.innerHTML += `
                    <div style="text-align: left;">
                        <span style="
                            display: inline-block;
                            background: #f1f0f0;
                            color: #000;
                            padding: 8px 12px; /* keep original padding */
                            border-radius: 15px 15px 15px 0;
                            max-width: 80%;
                            text-align: left;
                            margin-bottom: 6px;
                            font-size: 0.875rem;
                        ">${node.answer}</span>
                    </div>
                `;
                messages.scrollTop = messages.scrollHeight;
            }, 800);
        }
        if(node.children) renderOptions(node.children);
}
</script>

<!-- Chatbot End -->

</body>
</html>
