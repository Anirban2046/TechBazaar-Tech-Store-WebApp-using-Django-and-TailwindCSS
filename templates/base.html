{% load static %}
<!DOCTYPE HTML>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="pragma" content="no-cache" />
  <meta http-equiv="cache-control" content="max-age=604800" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>TechBazaar | Your Trusted Online Shopping Platform for Electronic Gadgets</title>

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

  <!-- TailwindCSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class'
    }
  </script>

  <!-- Feather icons CDN -->
  <script src="https://unpkg.com/feather-icons"></script>

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400&display=swap" rel="stylesheet">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  
  <!-- Fix for autofill/autocomplete styling in both light and dark modes -->
  <style>
    /* Light mode autofill styling - only for actually autofilled inputs */
    input:-webkit-autofill,
    input:-webkit-autofill:hover,
    input:-webkit-autofill:focus,
    input:-webkit-autofill:active,
    textarea:-webkit-autofill,
    textarea:-webkit-autofill:hover,
    textarea:-webkit-autofill:focus,
    textarea:-webkit-autofill:active,
    select:-webkit-autofill,
    select:-webkit-autofill:hover,
    select:-webkit-autofill:focus,
    select:-webkit-autofill:active {
      -webkit-box-shadow: 0 0 0 1000px rgb(255 255 255) inset !important;
      -webkit-text-fill-color: rgb(17 24 39) !important;
      caret-color: black !important;
    }

    /* Light mode autofill for gray backgrounds */
    input[class*="bg-gray-50"]:-webkit-autofill,
    input[class*="bg-gray-50"]:-webkit-autofill:hover,
    input[class*="bg-gray-50"]:-webkit-autofill:focus,
    input[class*="bg-gray-50"]:-webkit-autofill:active {
      -webkit-box-shadow: 0 0 0 1000px rgb(249 250 251) inset !important;
      -webkit-text-fill-color: rgb(17 24 39) !important;
      caret-color: black !important;
    }

    /* Dark mode autofill styling - only for actually autofilled inputs */
    .dark input:-webkit-autofill,
    .dark input:-webkit-autofill:hover,
    .dark input:-webkit-autofill:focus,
    .dark input:-webkit-autofill:active,
    .dark textarea:-webkit-autofill,
    .dark textarea:-webkit-autofill:hover,
    .dark textarea:-webkit-autofill:focus,
    .dark textarea:-webkit-autofill:active,
    .dark select:-webkit-autofill,
    .dark select:-webkit-autofill:hover,
    .dark select:-webkit-autofill:focus,
    .dark select:-webkit-autofill:active {
      -webkit-box-shadow: 0 0 0 1000px rgb(55 65 81) inset !important;
      -webkit-text-fill-color: rgb(243 244 246) !important;
      caret-color: white !important;
    }
    
    /* Dark mode autofill for specific gray-800 backgrounds */
    .dark input[class*="dark:bg-gray-800"]:-webkit-autofill,
    .dark input[class*="dark:bg-gray-800"]:-webkit-autofill:hover,
    .dark input[class*="dark:bg-gray-800"]:-webkit-autofill:focus,
    .dark input[class*="dark:bg-gray-800"]:-webkit-autofill:active {
      -webkit-box-shadow: 0 0 0 1000px rgb(31 41 55) inset !important;
      -webkit-text-fill-color: rgb(243 244 246) !important;
      caret-color: white !important;
    }

    /* Dark mode autofill for specific gray-700 backgrounds */
    .dark input[class*="dark:bg-gray-700"]:-webkit-autofill,
    .dark input[class*="dark:bg-gray-700"]:-webkit-autofill:hover,
    .dark input[class*="dark:bg-gray-700"]:-webkit-autofill:focus,
    .dark input[class*="dark:bg-gray-700"]:-webkit-autofill:active {
      -webkit-box-shadow: 0 0 0 1000px rgb(55 65 81) inset !important;
      -webkit-text-fill-color: rgb(243 244 246) !important;
      caret-color: white !important;
    }
    
    /* General cursor color fixes */
    .dark input,
    .dark textarea {
      caret-color: white;
    }

    /* Additional form-specific autofill overrides */
    form input:-webkit-autofill,
    form input:-webkit-autofill:hover,
    form input:-webkit-autofill:focus,
    form input:-webkit-autofill:active {
      -webkit-box-shadow: 0 0 0 1000px rgb(255 255 255) inset !important;
      -webkit-text-fill-color: rgb(17 24 39) !important;
      caret-color: black !important;
    }

    .dark form input:-webkit-autofill,
    .dark form input:-webkit-autofill:hover,
    .dark form input:-webkit-autofill:focus,
    .dark form input:-webkit-autofill:active,
    .dark form textarea:-webkit-autofill,
    .dark form textarea:-webkit-autofill:hover,
    .dark form textarea:-webkit-autofill:focus,
    .dark form textarea:-webkit-autofill:active {
      -webkit-box-shadow: 0 0 0 1000px rgb(55 65 81) inset !important;
      -webkit-text-fill-color: rgb(243 244 246) !important;
      caret-color: white !important;
    }
  </style>

  <script>
    // Initialize theme to light mode by default, ignore browser preferences
    (function() {
      const savedTheme = localStorage.getItem('theme');
      // Only apply dark mode if explicitly saved as 'dark' by user
      if (savedTheme === 'dark') {
        document.documentElement.classList.add('dark');
      } else {
        // Ensure light mode is default, remove any dark class
        document.documentElement.classList.remove('dark');
        // Set light theme in localStorage if no theme is saved
        if (!savedTheme) {
          localStorage.setItem('theme', 'light');
        }
      }
    })();
  </script>

  <script type="text/javascript">
    $(document).ready(function() {
      // Example: Thumbnail image swap
      $(document).on('click', '.thumb a', function(e){
        e.preventDefault();
        var newSrc = $(this).data('src') || $(this).attr('href');
        $('.mainImage img').attr('src', newSrc);
      });
    });
  </script>

  <script>
    // Prefetch likely next pages on hover
    document.addEventListener('mouseover', function(e) {
        if (e.target.tagName === 'A' && e.target.href) {
            const link = document.createElement('link');
            link.rel = 'prefetch';
            link.href = e.target.href;
            document.head.appendChild(link);
        }
    }, { once: true, passive: true });
    </script>
</head>
<body class="bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-300">

  <!-- navbar -->
  {% include 'includes/navbar.html' %}

  <script>
    // Ensure dark mode toggle icon is properly updated on page load
    document.addEventListener('DOMContentLoaded', function() {
      const darkModeIcon = document.getElementById('darkModeIcon');
      if (darkModeIcon) {
        const isDark = document.documentElement.classList.contains('dark');
        
        function updateDarkModeIcon(isDark) {
          if (isDark) {
            darkModeIcon.innerHTML = '<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>';
            darkModeIcon.setAttribute('data-feather', 'moon');
          } else {
            darkModeIcon.innerHTML = '<circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>';
            darkModeIcon.setAttribute('data-feather', 'sun');
          }
        }
        
        // Update icon on page load
        updateDarkModeIcon(isDark);
        
        // Listen for theme changes and update icon
        const themeObserver = new MutationObserver(function(mutations) {
          mutations.forEach(function(mutation) {
            if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
              const isDark = document.documentElement.classList.contains('dark');
              updateDarkModeIcon(isDark);
            }
          });
        });
        themeObserver.observe(document.documentElement, { attributes: true, attributeFilter: ['class'] });
      }
    });
  </script>

  {% block content %}
  <!-- page content -->
  {% endblock %}

   <!-- footer -->
   {% include 'includes/footer.html' %}



<!-- Chatbot Begin -->

<!-- Floating Chatbot Button -->
<div id="chatbot" class="fixed bottom-5 right-5 w-14 h-14 sm:w-16 sm:h-16 rounded-full bg-gradient-to-br from-teal-500 to-teal-700 shadow-lg flex items-center justify-center cursor-pointer z-50 transition-transform duration-200">
    <i id="chatbot-icon" class="fa fa-comments text-white text-lg sm:text-xl"></i>
</div>

<style>
  /* Ultra-small screens: shrink chatbot button and icon */
  @media (max-width: 400px) {
    #chatbot {
      width: 50px !important;
      height: 50px !important;
    }
    #chatbot-icon {
      font-size: 18px !important;
    }
  }
</style>


<!-- Chatbot Panel -->
<div id="chatbot-panel" class="fixed bottom-20 right-5 w-72 sm:w-80 max-h-[400px] sm:max-h-[500px] rounded-xl bg-white dark:bg-gray-800 shadow-lg flex-col overflow-hidden font-sans text-sm sm:text-base hidden z-50">
    <!-- Header -->
        <div style="
        background: linear-gradient(135deg, #17a2b8, #138496);
        color: #fff;
        padding: 12px 15px;
        font-weight: bold;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 16px;
    ">
        TechBazaar Help
        <div class="flex gap-3 sm:gap-4"> <!-- adjust gap for small screens -->
            <!-- Back to root icon -->
            <i id="chatbot-back" class="fa fa-arrow-left cursor-pointer text-base sm:text-lg" title="Back to root"></i>

            <!-- Clear chat icon -->
            <i id="chatbot-clear" class="fa fa-broom cursor-pointer text-base sm:text-lg" title="Clear chat"></i>
        </div>
    </div>

    <!-- Options -->
    <div id="chatbot-options" class="flex-1 overflow-y-auto p-2 sm:p-3 bg-gray-50 dark:bg-gray-700 text-xs sm:text-sm"></div>

    <!-- Messages -->
    <div id="chatbot-messages" class="flex flex-col gap-1 sm:gap-2 p-2 sm:p-3 overflow-y-auto max-h-[140px] sm:max-h-[180px] border-t border-gray-200 dark:border-gray-600 bg-white dark:bg-gray-800 text-xs sm:text-sm"></div>
</div>

<!-- Chatbot Script -->
<script>
    const chatbot = document.getElementById('chatbot');
    const panel = document.getElementById('chatbot-panel');
    const messages = document.getElementById('chatbot-messages');
    const options = document.getElementById('chatbot-options');
    const clearBtn = document.getElementById('chatbot-clear');
    const backBtn = document.getElementById('chatbot-back');

    // Hover scale effect
    chatbot.addEventListener('mouseenter', () => chatbot.style.transform = 'scale(1.1)');
    chatbot.addEventListener('mouseleave', () => chatbot.style.transform = 'scale(1)');

    // Toggle panel
    chatbot.addEventListener('click', () => {
        panel.classList.toggle('hidden');
        if (!panel.classList.contains('hidden')) renderOptions(faqTree);
    });

    // Clear chat
    clearBtn.addEventListener('click', () => messages.innerHTML = '');

    // Back to root
    backBtn.addEventListener('click', () => renderOptions(faqTree));

    // Listen for theme changes to update chatbot styling
    const observer = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
            if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                // Refresh button styles when theme changes
                const buttons = options.querySelectorAll('button');
                buttons.forEach(btn => {
                    btn.className = 'w-full mb-1 sm:mb-2 px-2 sm:px-3 py-1 sm:py-2 rounded bg-white dark:bg-gray-600 text-left shadow-sm hover:bg-blue-50 dark:hover:bg-gray-500 hover:translate-x-1 transition text-gray-900 dark:text-gray-100 border border-gray-200 dark:border-gray-500';
                });
                
                // Update existing bot message colors when theme changes
                updateExistingBotMessages();
            }
        });
    });
    observer.observe(document.documentElement, { attributes: true, attributeFilter: ['class'] });

    // Function to update existing bot message colors
    function updateExistingBotMessages() {
        const isDark = document.documentElement.classList.contains('dark');
        const botMessages = messages.querySelectorAll('.bot-message');
        
        botMessages.forEach(span => {
            const currentStyle = span.getAttribute('style');
            // Replace background and color values
            let newStyle = currentStyle
                .replace(/background:\s*[^;]+;/, `background: ${isDark ? '#374151' : '#f1f0f0'};`)
                .replace(/color:\s*[^;]+;/, `color: ${isDark ? '#f9fafb' : '#000'};`);
            span.setAttribute('style', newStyle);
        });
    }

    const faqTree = [
        { question: "Shipping & Delivery", children: [
            { question: "What are your shipping charges?", answer: "Shipping is free for orders over Tk 5000. Otherwise Tk 150." },
            { question: "How long does delivery take?", answer: "Delivery usually takes 2-5 business days within Bangladesh." },
            { question: "Do you ship internationally?", answer: "Currently, we only ship within Bangladesh." },
            { question: "Can I change my shipping address?", answer: "Yes, before the order is dispatched, contact support to change the address." }
        ]},
        { question: "Warranty & Returns", children: [
            { question: "Do you provide warranty?", answer: "Yes, all products come with manufacturer warranty." },
            { question: "How can I return an item?", answer: "You can return items within 7 days of delivery. Contact support to start the process." },
            { question: "What if my product is damaged?", answer: "Contact support immediately, and we will assist with replacement or refund." }
        ]},
        { question: "Orders & Support", children: [
            { question: "Can I cancel my order?", answer: "Yes, cancel before shipment. Contact support to cancel." },
            { question: "Can I modify my order?", answer: "Only before dispatch. Contact support for changes." },
            { question: "What if I receive a wrong product?", answer: "Contact support immediately for a replacement or refund." }
        ]},
        { question: "Payments", children: [
            { question: "What payment methods do you accept?", answer: "We accept bKash, Rocket, Nagad, Upay, VisaCard, MasterCard and DBBL Nexus Card." },
            { question: "Is online payment secure?", answer: "Yes, all payments are encrypted and secure." },
            { question: "Can I pay on delivery?", answer: "Currently, Cash on Delivery is not available; please use online payment methods." }
        ]},
        { question: "Products", children: [
            { question: "Do you have smartphones?", answer: "Yes, we have a variety of smartphones from popular brands."  },
            { question: "Do you sell laptops?", answer: "Yes, laptops from multiple brands are available." },
            { question: "Do you sell accessories?", answer: "Yes, keyboards, mice, headphones, speakers, tablets, and more." },
            { question: "Are your products genuine?", answer: "Yes, we sell only genuine, brand new products." }
        ]}
    ];

    function renderOptions(tree) {
        options.innerHTML = '';
        tree.forEach(item => {
            const btn = document.createElement('button');
            btn.textContent = item.question;
            btn.className = 'w-full mb-1 sm:mb-2 px-2 sm:px-3 py-1 sm:py-2 rounded bg-white dark:bg-gray-600 text-left shadow-sm hover:bg-blue-50 dark:hover:bg-gray-500 hover:translate-x-1 transition text-gray-900 dark:text-gray-100 border border-gray-200 dark:border-gray-500';
            btn.addEventListener('click', () => handleClick(item));
            options.appendChild(btn);
        });
    }

    // Handle Q&A with chat bubble styling
    function handleClick(node) {
        if(node.answer) {
            // User message (right side bubble)
            messages.innerHTML += `
                <div style="text-align: right;">
                    <span style="
                        display: inline-block;
                        background: #17a2b8;
                        color: #fff;
                        padding: 6px 10px; /* smaller padding for user message */
                        border-radius: 15px 15px 0 15px;
                        max-width: 80%;
                        text-align: left;
                        margin-bottom: 6px;
                        font-size: 0.875rem; /* scale for smaller screens */
                    ">${node.question}</span>
                </div>
            `;
            messages.scrollTop = messages.scrollHeight;

            // Bot reply after delay (left side bubble with dark mode support)
            setTimeout(() => {
                const isDark = document.documentElement.classList.contains('dark');
                const botDiv = document.createElement('div');
                botDiv.style.textAlign = 'left';
                botDiv.innerHTML = `
                    <span class="bot-message" style="
                        display: inline-block;
                        background: ${isDark ? '#374151' : '#f1f0f0'};
                        color: ${isDark ? '#f9fafb' : '#000'};
                        padding: 8px 12px;
                        border-radius: 15px 15px 15px 0;
                        max-width: 80%;
                        text-align: left;
                        margin-bottom: 6px;
                        font-size: 0.875rem;
                    ">${node.answer}</span>
                `;
                messages.appendChild(botDiv);
                messages.scrollTop = messages.scrollHeight;
            }, 800);
        }
        if(node.children) renderOptions(node.children);
}
</script>

<!-- Chatbot End -->

</body>
</html>
