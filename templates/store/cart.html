{% extends 'base.html' %}
{% load static %}

{% block content %}

<section class="py-6 bg-gray-50">
  {% include 'includes/alerts.html' %}
  <div class="container mx-auto px-2 sm:px-4">

    {% if not cart_items %}
      <div class="text-center mt-10">
        <h2 class="text-2xl sm:text-3xl md:text-4xl font-semibold">Your cart is empty</h2>
        <a href="{% url 'store' %}" class="inline-block mt-4 bg-blue-500 text-white py-2 px-4 rounded-md text-sm sm:text-base md:text-lg hover:bg-blue-600 transition-colors duration-300">
          Continue Shopping
        </a>
      </div>
    {% else %}

    <div class="flex flex-col lg:flex-row lg:gap-6">

      <!-- Cart Items -->
      <aside class="flex-1">
  <div class="bg-white rounded-lg shadow-md overflow-x-auto">
    <table class="w-full divide-y divide-gray-200 text-sm sm:text-base md:text-lg table-auto">
      <!-- Table header (hidden on mobile) -->
      <thead class="bg-gray-100 text-gray-700 uppercase text-xs sm:text-sm md:text-base hidden sm:table-header-group">
        <tr>
          <th scope="col" class="px-4 py-3 text-left w-[40%]">Product</th>
          <th scope="col" class="px-4 py-3 text-center w-[30%]">Quantity</th>
          <th scope="col" class="px-4 py-3 text-center w-[20%]">Price</th>
          <th scope="col" class="px-4 py-3 text-right w-[10%]">Remove</th>
        </tr>
      </thead>

      <tbody class="divide-y divide-gray-200">
        {% for cart_item in cart_items %}
        <tr class="block sm:table-row hover:bg-gray-50">
          <!-- Product + Variations -->
          <td class="block sm:table-cell px-4 py-3">
            <div class="flex flex-col items-center sm:flex-row sm:items-center gap-2">
              <img src="{{ cart_item.product.images.url }}" class="w-16 h-16 object-cover rounded">
              <div class="flex-1 text-center sm:text-left">
                <a href="{{ cart_item.product.get_url }}" class="font-medium text-gray-900 hover:text-blue-500 block truncate">
                  {{ cart_item.product.product_name }}
                </a>
                <p class="text-gray-500 text-xs sm:text-sm mt-1">
                  {% if cart_item.variations.all %}
                    {% for item in cart_item.variations.all %}
                      {{ item.variation_category | capfirst }} : {{ item.variation_value | capfirst }} <br>
                    {% endfor %}
                  {% endif %}
                </p>
              </div>
            </div>
          </td>

          <!-- Quantity controls -->
          <td class="block sm:table-cell px-4 py-3 text-center mt-2 sm:mt-0">
            <div class="flex items-center justify-center gap-2 flex-wrap">
              <!-- Minus button -->
              <a href="{% url 'remove_cart' cart_item.product.id cart_item.id %}" 
                 class="inline-flex items-center justify-center w-8 h-8 bg-gray-100 text-gray-700 rounded-md shadow-sm hover:bg-gray-200 transition-colors duration-200">
                <i class="fa fa-minus"></i>
              </a>

              <!-- Quantity input -->
              <form action="{% url 'add_cart' cart_item.product.id %}" method="POST" class="inline-block">
                {% csrf_token %}
                {% for item in cart_item.variations.all %}
                  <input type="hidden" name="{{ item.variation_category|lower }}" value="{{ item.variation_value|capfirst }}">
                {% endfor %}
                <input type="number" name="quantity" min="1" value="{{ cart_item.quantity }}"
                       class="w-12 text-center border border-gray-300 rounded-md py-1 no-spinners"
                       onkeydown="if(event.key==='Enter'){this.form.submit();}">
              </form>

              <!-- Plus button -->
              <form action="{% url 'add_cart' cart_item.product.id %}" method="POST" class="inline-block">
                {% csrf_token %}
                {% for item in cart_item.variations.all %}
                  <input type="hidden" name="{{ item.variation_category|lower }}" value="{{ item.variation_value|capfirst }}">
                {% endfor %}
                <button type="submit"
                        class="inline-flex items-center justify-center w-8 h-8 bg-gray-100 text-gray-700 rounded-md shadow-sm hover:bg-gray-200 transition-colors duration-200">
                  <i class="fa fa-plus"></i>
                </button>
              </form>
            </div>
          </td>

          <!-- Price -->
          <td class="block sm:table-cell px-4 py-3 text-center mt-2 sm:mt-0">
            <span class="font-medium">Tk {{ cart_item.sub_total }}</span><br>
            <small class="text-gray-500">Tk {{ cart_item.product.price }} each</small>
          </td>

          <!-- Remove -->
          <td class="block sm:table-cell px-4 py-3 mt-2 sm:mt-0">
            <a href="{% url 'remove_cart_item' cart_item.product.id cart_item.id %}" 
               onclick="return confirm('Are you sure you want to delete this item?')"
               class="block w-full sm:inline-block text-center sm:text-right bg-red-500 text-white px-4 py-1.5 rounded-md font-medium 
                      hover:text-gray-300 hover:bg-red-600 transition-colors duration-200">
                    Remove
                  </a>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </aside>

      <!-- Cart Summary -->
      <aside class="w-full lg:w-1/3 mt-6 lg:mt-0">
        <div class="bg-white rounded-lg shadow-md p-3 sm:p-4 md:p-6 space-y-3">
          
          <div class="flex justify-between text-xs sm:text-sm md:text-base">
            <span>Total price:</span>
            <span class="font-medium">Tk {{ total }}</span>
          </div>
          
          <div class="flex justify-between text-xs sm:text-sm md:text-base">
            <span>Shipping:</span>
            <span class="font-medium">Tk {{ shipping_charge }}</span>
          </div>
          
          <div class="flex justify-between font-semibold text-gray-900 text-sm sm:text-base md:text-lg">
            <span>Grand Total:</span>
            <span>Tk {{ grand_total }}</span>
          </div>
          
          <hr class="border-gray-300">

          <a href="{% url 'checkout' %}" 
            class="block w-full bg-blue-500 text-white py-2 text-xs sm:text-sm md:text-base rounded-md text-center hover:bg-blue-600 transition-colors duration-300">
            Checkout
          </a>
          
          <a href="{% url 'store' %}" 
            class="block w-full bg-gray-200 text-gray-800 py-2 text-xs sm:text-sm md:text-base rounded-md text-center hover:bg-gray-300 transition-colors duration-300">
            Continue Shopping
          </a>

        </div>
      </aside>



    </div>
    {% endif %}

  </div>
</section>

<style>
/* Hide number input arrows (Chrome, Safari, Edge, Opera) */
.no-spinners::-webkit-outer-spin-button,
.no-spinners::-webkit-inner-spin-button {
  -webkit-appearance: none;
  margin: 0;
}

/* Hide number input arrows (Firefox) */
.no-spinners[type=number] {
  -moz-appearance: textfield;
}
</style>


{% endblock %}
