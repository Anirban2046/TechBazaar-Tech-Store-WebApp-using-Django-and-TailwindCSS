{% extends 'base.html' %}
{% load static %}

{% block content %}

<section class="min-h-[83vh] bg-gradient-to-br from-gray-50 via-white to-gray-100 py-4 sm:py-8 lg:py-12">
  {% include 'includes/alerts.html' %}
  <div class="container mx-auto px-3 sm:px-4 lg:px-6">

    {% if not cart_items %}
      <!-- Empty Cart State -->
      <div class="max-w-lg sm:max-w-xl lg:max-w-2xl mx-auto text-center">
        <div class="bg-white rounded-2xl sm:rounded-3xl shadow-xl p-6 sm:p-8 md:p-12 lg:p-16 border border-gray-100">
          <div class="w-16 h-16 sm:w-20 sm:h-20 lg:w-24 lg:h-24 mx-auto mb-4 sm:mb-6 bg-gradient-to-br from-blue-100 to-blue-200 rounded-full flex items-center justify-center">
            <svg class="w-8 h-8 sm:w-10 sm:h-10 lg:w-12 lg:h-12 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-2.5 2.5M7 13l2.5 2.5m6-7h.01M19 19a2 2 0 11-4 0 2 2 0 014 0zM9 19a2 2 0 11-4 0 2 2 0 014 0z"></path>
            </svg>
          </div>
          <h2 class="text-lg sm:text-xl md:text-2xl lg:text-3xl xl:text-4xl font-semibold">Your cart is empty</h2>
          <a href="{% url 'store' %}" 
             class="inline-block mt-4 sm:mt-6 bg-gradient-to-r from-blue-600 to-blue-700 text-white py-2 sm:py-2 md:py-3 px-4 sm:px-4 md:px-6 rounded-full text-sm sm:text-base md:text-lg lg:text-xl font-semibold hover:from-blue-700 hover:to-blue-800 transform hover:scale-105 transition-all duration-300 shadow-lg hover:shadow-xl focus:outline-none">
            Browse Products
          </a>
        </div>
      </div>
    {% else %}

    <!-- Layout container -->
    <div class="flex flex-col md:flex-col lg:flex-row gap-3 sm:gap-4 lg:gap-6">

      <!-- Cart Items (Main content) - Always first on mobile -->
      <div class="flex-1 order-1 lg:w-2/3">
        <div class="bg-white rounded-xl sm:rounded-2xl shadow-xl overflow-hidden border border-gray-100">
          <!-- Table Header -->
          <div class="hidden sm:block bg-gradient-to-r from-gray-50 to-gray-100 px-4 sm:px-6 py-3 sm:py-4 border-b border-gray-200">
            <div class="grid grid-cols-12 gap-4 text-xs sm:text-sm font-semibold text-gray-700 uppercase tracking-wider">
              <div class="col-span-6">Product</div>
              <div class="col-span-2 text-center">Quantity</div>
              <div class="col-span-2 text-center">Price</div>
              <div class="col-span-2 text-right">Actions</div>
            </div>
          </div>

          <!-- Items -->
          <div class="divide-y divide-gray-100">
            {% for cart_item in cart_items %}
            <div class="p-3 sm:p-4 lg:p-6 hover:bg-gray-50 transition-all duration-200 group">
              <div class="grid grid-cols-12 gap-3 sm:gap-4 items-center">
                
                <!-- Product -->
                <div class="col-span-12 sm:col-span-6">
                  <div class="flex flex-col sm:flex-row items-start sm:items-center gap-2 sm:gap-3">
                    <img src="{{ cart_item.product.images.url }}" 
                         class="w-10 h-10 sm:w-12 sm:h-12 lg:w-16 lg:h-16 object-cover rounded-lg sm:rounded-xl shadow-md group-hover:shadow-lg transition-shadow duration-200" 
                         alt="{{ cart_item.product.product_name }}">
                    <div class="flex-1 min-w-0">
                      <a href="{{ cart_item.product.get_url }}" 
                         class="font-medium text-gray-900 hover:text-blue-500 block transition-colors duration-200 focus:outline-none">
                        {{ cart_item.product.product_name }}
                      </a>
                      {% if cart_item.variations.all %}
                      <p class="text-gray-500 text-xs sm:text-sm mt-1">
                        {% for item in cart_item.variations.all %}
                        {{ item.variation_category|capfirst }}: {{ item.variation_value|capfirst }}<br>
                        {% endfor %}
                      </p>
                      {% endif %}
                    </div>
                  </div>
                </div>

                <!-- Quantity controls -->
                <div class="col-span-6 sm:col-span-2 mt-1 sm:mt-0">
                  <div class="flex justify-start sm:justify-center">
                    <div class="inline-flex items-center justify-center gap-1 sm:gap-2 lg:gap-3 bg-gray-50 rounded-lg sm:rounded-xl p-1 sm:p-2">
                      
                      <!-- Minus button -->
                      <a href="{% url 'remove_cart' cart_item.product.id cart_item.id %}" 
                         {% if cart_item.quantity == 1 %} onclick="return confirm('This will remove the item from cart. Are you sure?')"{% endif %}
                         class="inline-flex items-center justify-center w-6 h-6 sm:w-6 sm:h-6 lg:w-8 lg:h-8 bg-white text-gray-600 rounded-md sm:rounded-lg shadow-sm hover:bg-red-50 hover:text-red-600 transition-all duration-200 border border-gray-200 focus:outline-none">
                        <svg class="w-3 h-3 sm:w-3 sm:h-3 lg:w-4 lg:h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"></path>
                        </svg>
                      </a>

                      <!-- Quantity input -->
                      <form action="{% url 'add_cart' cart_item.product.id %}" method="POST" class="inline-block">
                        {% csrf_token %}
                        {% for item in cart_item.variations.all %}
                          <input type="hidden" name="{{ item.variation_category|lower }}" value="{{ item.variation_value|capfirst }}">
                        {% endfor %}
                        <input type="number" name="quantity" min="1" value="{{ cart_item.quantity }}"
                               class="no-spinners w-8 sm:w-10 lg:w-12 text-center border-2 border-gray-200 rounded-md sm:rounded-lg py-1 sm:py-1 lg:py-1.5 text-xs sm:text-xs md:text-sm lg:text-base font-semibold focus:border-blue-500 focus:outline-none transition-colors duration-200"
                               onkeydown="if(event.key==='Enter'){this.form.submit();}">
                      </form>

                      <!-- Plus button -->
                      <form action="{% url 'add_cart' cart_item.product.id %}" method="POST" class="inline-block">
                        {% csrf_token %}
                        {% for item in cart_item.variations.all %}
                          <input type="hidden" name="{{ item.variation_category|lower }}" value="{{ item.variation_value|capfirst }}">
                        {% endfor %}
                        <button type="submit"
                                class="inline-flex items-center justify-center w-6 h-6 sm:w-6 sm:h-6 lg:w-8 lg:h-8 bg-white text-gray-600 rounded-md sm:rounded-lg shadow-sm hover:bg-green-50 hover:text-green-600 transition-all duration-200 border border-gray-200 focus:outline-none">
                          <svg class="w-3 h-3 sm:w-3 sm:h-3 lg:w-4 lg:h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                          </svg>
                        </button>
                      </form>

                    </div>
                  </div>
                </div>

                <!-- Price -->
                <div class="col-span-6 sm:col-span-2 mt-1 sm:mt-0">
                  <div class="text-left sm:text-center">
                    <span class="font-medium text-xs sm:text-sm md:text-base lg:text-base">Tk {{ cart_item.sub_total }}</span><br>
                    <small class="text-gray-500 text-xs">Tk {{ cart_item.product.price }} each</small>
                  </div>
                </div>

                <!-- Actions -->
                <div class="col-span-12 sm:col-span-2 mt-2 sm:mt-0">
                  <div class="flex justify-start sm:justify-end">
                    <a href="{% url 'remove_cart_item' cart_item.product.id cart_item.id %}" 
                       onclick="return confirm('Are you sure you want to delete this item?')"
                       class="bg-white border-2 border-red-200 text-red-600 px-2 sm:px-2 lg:px-3 py-1 sm:py-1 lg:py-2 rounded-md sm:rounded-lg font-semibold hover:bg-red-50 hover:border-red-300 transition-all duration-200 text-xs sm:text-sm md:text-base lg:text-base whitespace-nowrap focus:outline-none">
                      Remove
                    </a>
                  </div>
                </div>

              </div>
            </div>
            {% endfor %}
          </div>
        </div>
      </div>

      <!-- Cart Summary Sidebar - Always second on mobile -->
      <aside class="w-full lg:w-1/3 order-2">
        <div class="bg-white rounded-xl sm:rounded-2xl shadow-xl p-4 sm:p-6 md:p-8 border border-gray-100 space-y-3 sm:space-y-4">
          <div class="w-12 h-12 sm:w-16 sm:h-16 mx-auto mb-3 sm:mb-4 bg-gradient-to-br from-blue-100 to-blue-200 rounded-full flex items-center justify-center">
            <svg class="w-6 h-6 sm:w-8 sm:h-8 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
              <path d="M3 1a1 1 0 000 2h1.22l.305 1.222a.997.997 0 00.01.042l1.358 5.43-.893.892C3.74 11.846 4.632 14 6.414 14H15a1 1 0 000-2H6.414l1-1H14a1 1 0 00.894-.553l3-6A1 1 0 0017 3H6.28l-.31-1.243A1 1 0 005 1H3zM16 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM6.5 18a1.5 1.5 0 100-3 1.5 1.5 0 000 3z"></path>
            </svg>
          </div>
          <h3 class="font-bold text-base sm:text-lg md:text-xl lg:text-2xl text-gray-900 text-center">Order Summary</h3>
          
          <div class="space-y-2 sm:space-y-3 border-t border-b border-gray-200 py-3 sm:py-4">
            <div class="flex justify-between text-xs sm:text-sm md:text-base lg:text-base">
              <span class="text-gray-600">Subtotal:</span>
              <span class="font-medium">Tk {{ total }}</span>
            </div>
            
            <div class="flex justify-between text-xs sm:text-sm md:text-base lg:text-base">
              <span class="text-gray-600">Shipping:</span>
              <span class="font-medium">Tk {{ shipping_charge }}</span>
            </div>
            
            <div class="flex justify-between font-semibold text-gray-900 text-sm sm:text-base md:text-lg lg:text-lg">
              <span>Grand Total:</span>
              <span class="text-blue-600">Tk {{ grand_total }}</span>
            </div>
          </div>

          <a href="{% url 'checkout' %}" 
            class="block w-full bg-gradient-to-r from-green-600 to-green-700 text-white py-2 sm:py-2 md:py-3 px-3 sm:px-4 md:px-6 rounded-full text-center font-semibold hover:from-green-700 hover:to-green-800 transform hover:scale-105 transition-all duration-300 shadow-lg hover:shadow-xl text-xs sm:text-sm md:text-base lg:text-base focus:outline-none">
            Proceed to Checkout
          </a>
          
          <a href="{% url 'store' %}" 
            class="block w-full bg-gradient-to-r from-blue-600 to-blue-700 text-white py-2 sm:py-2 md:py-3 px-3 sm:px-4 md:px-6 rounded-full text-center font-semibold hover:from-blue-700 hover:to-blue-800 transform hover:scale-105 transition-all duration-300 shadow-lg hover:shadow-xl text-xs sm:text-sm md:text-base lg:text-base focus:outline-none">
            Continue Shopping
          </a>
        </div>
      </aside>

    </div>
    {% endif %}

  </div>
</section>

<style>
/* Hide number input arrows (Chrome, Safari, Edge, Opera) */
.no-spinners::-webkit-outer-spin-button,
.no-spinners::-webkit-inner-spin-button {
  -webkit-appearance: none;
  margin: 0;
}

/* Hide number input arrows (Firefox) */
.no-spinners[type=number] {
  -moz-appearance: textfield;
}
</style>

{% endblock %}