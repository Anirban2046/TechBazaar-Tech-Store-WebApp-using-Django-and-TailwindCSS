{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics Dashboard</title>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- TailwindCSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'inter': ['Inter', 'sans-serif'],
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.6s ease-in-out',
                        'slide-up': 'slideUp 0.4s ease-out',
                        'bounce-subtle': 'bounceSubtle 2s infinite',
                        'pulse-glow': 'pulseGlow 2s ease-in-out infinite',
                        'shimmer': 'shimmer 2s linear infinite',
                    },
                    colors: {
                        primary: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1',
                        }
                    }
                }
            }
        }
    </script>

    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes bounceSubtle {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-4px); }
            60% { transform: translateY(-2px); }
        }
        @keyframes pulseGlow {
            0%, 100% { box-shadow: 0 0 5px rgba(59, 130, 246, 0.3); }
            50% { box-shadow: 0 0 20px rgba(59, 130, 246, 0.6); }
        }
        @keyframes shimmer {
            0% { background-position: -468px 0; }
            100% { background-position: 468px 0; }
        }
        .chart-container { 
            position: relative; 
            height: 350px; 
            min-height: 300px;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #667eea 100%);
            background-size: 200% 200%;
            animation: gradientShift 8s ease infinite;
        }
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .card-hover {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid transparent;
        }
        .card-hover:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15);
            border-color: rgba(59, 130, 246, 0.1);
        }
        .growth-positive { color: #10b981; }
        .growth-negative { color: #ef4444; }
        .shimmer {
            background: linear-gradient(90deg, #f3f4f6 25%, #e5e7eb 50%, #f3f4f6 75%);
            background-size: 200% 100%;
            animation: shimmer 2s infinite;
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .table-row {
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
        }
        .table-row:hover {
            background-color: #f8fafc;
            border-left-color: #3b82f6;
            transform: translateX(2px);
        }
    </style>
</head>

<body class="font-inter bg-gradient-to-br from-gray-50 via-blue-50 to-indigo-50 text-gray-900 min-h-screen">

    <!-- Main Container -->
    <div class="min-h-screen">
        
        <!-- Header with Enhanced Gradient -->
        <div class="gradient-bg text-white px-6 py-12 mb-8 relative overflow-hidden">
            <!-- Background Pattern -->
            <div class="absolute inset-0 opacity-10">
                <div class="absolute inset-0" style="background-image: radial-gradient(circle at 25px 25px, white 2px, transparent 2px); background-size: 50px 50px;"></div>
            </div>
            
            <div class="max-w-7xl mx-auto relative z-10">
                <div class="flex flex-col lg:flex-row lg:justify-between lg:items-center gap-8">
                    <div class="animate-fade-in">
                        <h1 class="text-5xl font-bold mb-3 bg-clip-text text-transparent bg-gradient-to-r from-white to-blue-100">
                            Analytics Dashboard
                        </h1>
                        <p class="text-blue-100 text-xl font-light">Comprehensive insights and performance metrics </p>
                    </div>
                    
                    <!-- Enhanced Filters -->
                    <div class="animate-slide-up">
                        <form method="get" class="glass-effect rounded-3xl p-8 shadow-2xl">
                            <h3 class="text-lg font-semibold mb-4 text-white">Filter Data</h3>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-white/90 mb-2">
                                        <i class="fas fa-calendar-start mr-1"></i>Start Date
                                    </label>
                                    <input type="date" name="start" value="{{ request.GET.start }}" 
                                           class="w-full bg-white/20 border border-white/30 rounded-xl px-4 py-3 text-white placeholder-white/70 focus:ring-2 focus:ring-white/50 focus:border-transparent transition-all">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-white/90 mb-2">
                                        <i class="fas fa-calendar-end mr-1"></i>End Date
                                    </label>
                                    <input type="date" name="end" value="{{ request.GET.end }}" 
                                           class="w-full bg-white/20 border border-white/30 rounded-xl px-4 py-3 text-white placeholder-white/70 focus:ring-2 focus:ring-white/50 focus:border-transparent transition-all">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-white/90 mb-2">
                                        <i class="fas fa-tags mr-1"></i>Category
                                    </label>
                                    <select name="category" class="w-full bg-white/20 border border-white/30 rounded-xl px-4 py-3 text-white focus:ring-2 focus:ring-white/50 focus:border-transparent transition-all">
                                        <option value="">All Categories</option>
                                        {% for cat in categories %}
                                            <option value="{{ cat.id }}" {% if request.GET.category == cat.id|stringformat:"s" %}selected{% endif %} class="text-gray-900">{{ cat.category_name }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                            <div class="mt-6 flex justify-center">
                                <button type="submit" class="bg-white text-purple-600 px-8 py-3 rounded-xl font-semibold hover:bg-gray-100 transition-all duration-300 transform hover:scale-105 shadow-lg">
                                    <i class="fas fa-search mr-2"></i>Apply Filters
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <div class="max-w-7xl mx-auto px-6 pb-8">
            
            <!-- Enhanced KPI Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-10">
                <!-- Total Sales -->
                <div class="bg-white rounded-3xl shadow-xl p-8 card-hover animate-fade-in border border-blue-100">
                    <div class="flex items-center justify-between mb-6">
                        <div class="bg-gradient-to-r from-blue-500 to-blue-600 p-4 rounded-2xl shadow-lg">
                            <p class="text-white text-4xl font-bold">à§³</p>
                        </div>
                        <div class="text-right">
                            <div class="text-xs text-gray-500 font-medium uppercase tracking-wider">Growth</div>
                            <div class="text-lg font-bold flex items-center justify-end {% if sales_growth >= 0 %}growth-positive{% else %}growth-negative{% endif %}">
                                <i class="fas fa-{% if sales_growth >= 0 %}arrow-up{% else %}arrow-down{% endif %} mr-1"></i>
                                {{ sales_growth }}%
                            </div>
                        </div>
                    </div>
                    <div>
                        <p class="text-gray-600 text-sm font-semibold mb-2 uppercase tracking-wide">Total Sales</p>
                        <p class="text-3xl font-bold text-gray-900 mb-1">Tk {{ total_sales }}</p>
                        <p class="text-xs text-gray-500">Revenue generated</p>
                    </div>
                </div>

                <!-- Total Orders -->
                <div class="bg-white rounded-3xl shadow-xl p-8 card-hover animate-fade-in border border-green-100" style="animation-delay: 0.1s">
                    <div class="flex items-center justify-between mb-6">
                        <div class="bg-gradient-to-r from-green-500 to-green-600 p-4 rounded-2xl shadow-lg">
                            <i class="fas fa-shopping-cart text-white text-2xl"></i>
                        </div>
                        <div class="text-right">
                            <div class="text-xs text-gray-500 font-medium uppercase tracking-wider">Growth</div>
                            <div class="text-lg font-bold flex items-center justify-end {% if orders_growth >= 0 %}growth-positive{% else %}growth-negative{% endif %}">
                                <i class="fas fa-{% if orders_growth >= 0 %}arrow-up{% else %}arrow-down{% endif %} mr-1"></i>
                                {{ orders_growth }}%
                            </div>
                        </div>
                    </div>
                    <div>
                        <p class="text-gray-600 text-sm font-semibold mb-2 uppercase tracking-wide">Total Orders</p>
                        <p class="text-3xl font-bold text-gray-900 mb-1">{{ total_orders }}</p>
                        <p class="text-xs text-gray-500">Orders processed</p>
                    </div>
                </div>

                <!-- Average Order Value -->
                <div class="bg-white rounded-3xl shadow-xl p-8 card-hover animate-fade-in border border-purple-100" style="animation-delay: 0.2s">
                    <div class="flex items-center justify-between mb-6">
                        <div class="bg-gradient-to-r from-purple-500 to-purple-600 p-4 rounded-2xl shadow-lg">
                            <i class="fas fa-chart-line text-white text-2xl"></i>
                        </div>
                        <div class="text-right">
                            <div class="text-xs text-gray-500 font-medium uppercase tracking-wider">Products</div>
                            <div class="text-lg font-bold text-gray-700">{{ total_products_sold }}</div>
                        </div>
                    </div>
                    <div>
                        <p class="text-gray-600 text-sm font-semibold mb-2 uppercase tracking-wide">Avg Order Value</p>
                        <p class="text-3xl font-bold text-gray-900 mb-1">Tk {{ avg_order_value }}</p>
                        <p class="text-xs text-gray-500">Per transaction</p>
                    </div>
                </div>

                <!-- Customer Metrics -->
                <div class="bg-white rounded-3xl shadow-xl p-8 card-hover animate-fade-in border border-orange-100" style="animation-delay: 0.3s">
                    <div class="flex items-center justify-between mb-6">
                        <div class="bg-gradient-to-r from-orange-500 to-orange-600 p-4 rounded-2xl shadow-lg">
                            <i class="fas fa-users text-white text-2xl"></i>
                        </div>
                        <div class="text-right">
                            <div class="text-xs text-gray-500 font-medium uppercase tracking-wider">Average Rating</div>
                            <div class="text-lg font-bold text-yellow-600 flex items-center justify-end">
                                <i class="fas fa-star mr-1"></i> {{ average_rating }}
                            </div>
                        </div>
                    </div>
                    <div>
                        <p class="text-gray-600 text-sm font-semibold mb-2 uppercase tracking-wide">Total Customers</p>
                        <p class="text-3xl font-bold text-gray-900 mb-1">{{ total_customers }}</p>
                        <p class="text-xs text-gray-500">Active users</p>
                    </div>
                </div>
            </div>

            <!-- Enhanced Activity Summary -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
                <div class="bg-white rounded-2xl shadow-lg p-6 border-l-4 border-blue-500 hover:shadow-xl transition-all duration-300">
                    <div class="flex items-center">
                        <div class="bg-blue-100 p-3 rounded-xl mr-4">
                            <i class="fas fa-clock text-blue-600 text-lg"></i>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600 font-medium">Recent Orders</p>
                            <p class="text-3xl font-bold text-gray-900">{{ recent_orders_count }}</p>
                            <p class="text-xs text-gray-500">Last 7 days</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-2xl shadow-lg p-6 border-l-4 border-green-500 hover:shadow-xl transition-all duration-300">
                    <div class="flex items-center">
                        <div class="bg-green-100 p-3 rounded-xl mr-4">
                            <i class="fas fa-comment text-green-600 text-lg"></i>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600 font-medium">New Reviews</p>
                            <p class="text-3xl font-bold text-gray-900">{{ recent_reviews_count }}</p>
                            <p class="text-xs text-gray-500">Last 7 days</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-2xl shadow-lg p-6 border-l-4 border-purple-500 hover:shadow-xl transition-all duration-300">
                    <div class="flex items-center">
                        <div class="bg-purple-100 p-3 rounded-xl mr-4">
                            <i class="fas fa-user-plus text-purple-600 text-lg"></i>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600 font-medium">New Customers</p>
                            <p class="text-3xl font-bold text-gray-900">{{ recent_customers_count }}</p>
                            <p class="text-xs text-gray-500">Last 7 days</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Enhanced Charts Grid -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-10">
                
                <!-- Sales & Orders Trend -->
                <div class="bg-white rounded-3xl shadow-xl p-8 hover:shadow-2xl transition-all duration-300">
                    <div class="flex items-center justify-between mb-8">
                        <h3 class="text-2xl font-bold text-gray-900">Sales & Orders Trend</h3>
                        <div class="flex space-x-6">
                            <div class="flex items-center">
                                <div class="w-4 h-4 bg-blue-500 rounded-full mr-3"></div>
                                <span class="text-sm font-medium text-gray-600">Sales (Tk)</span>
                            </div>
                            <div class="flex items-center">
                                <div class="w-4 h-4 bg-green-500 rounded-full mr-3"></div>
                                <span class="text-sm font-medium text-gray-600">Orders</span>
                            </div>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="salesOrdersChart"></canvas>
                    </div>
                </div>

                <!-- Category Performance -->
                <div class="bg-white rounded-3xl shadow-xl p-8 hover:shadow-2xl transition-all duration-300">
                    <h3 class="text-2xl font-bold text-gray-900 mb-8">Category Performance</h3>
                    <div class="chart-container">
                        <canvas id="categoryChart"></canvas>
                    </div>
                </div>

                <!-- Monthly Revenue Trend -->
                <div class="bg-white rounded-3xl shadow-xl p-8 hover:shadow-2xl transition-all duration-300">
                    <h3 class="text-2xl font-bold text-gray-900 mb-8">Monthly Revenue Trend</h3>
                    <div class="chart-container">
                        <canvas id="monthlyRevenueChart"></canvas>
                    </div>
                </div>

                <!-- Order Status Distribution -->
                <div class="bg-white rounded-3xl shadow-xl p-8 hover:shadow-2xl transition-all duration-300">
                    <h3 class="text-2xl font-bold text-gray-900 mb-8">Order Status Distribution</h3>
                    <div class="chart-container">
                        <canvas id="orderStatusChart"></canvas>
                    </div>
                </div>

                <!-- Top Products by Revenue -->
                <div class="bg-white rounded-3xl shadow-xl p-8 hover:shadow-2xl transition-all duration-300">
                    <h3 class="text-2xl font-bold text-gray-900 mb-8">Top 5 Products by Revenue</h3>
                    <div class="chart-container">
                        <canvas id="topProductsChart"></canvas>
                    </div>
                </div>

                <!-- Customer Acquisition -->
                <div class="bg-white rounded-3xl shadow-xl p-8 hover:shadow-2xl transition-all duration-300">
                    <h3 class="text-2xl font-bold text-gray-900 mb-8">Customer Acquisition</h3>
                    <div class="chart-container">
                        <canvas id="customerAcquisitionChart"></canvas>
                    </div>
                </div>
            </div>
                

    <!-- Chart.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>

    <script>
        // Chart.js Configuration with Professional Styling
        Chart.defaults.font.family = 'Inter, sans-serif';
        Chart.defaults.color = '#64748b';
        Chart.defaults.borderColor = 'rgba(0, 0, 0, 0.08)';

        // Professional color palette
        const colorPalette = {
            primary: ['#3b82f6', '#1d4ed8', '#1e40af', '#1e3a8a'],
            secondary: ['#10b981', '#059669', '#047857', '#065f46'],
            accent: ['#8b5cf6', '#7c3aed', '#6d28d9', '#5b21b6'],
            warning: ['#f59e0b', '#d97706', '#b45309', '#92400e'],
            error: ['#ef4444', '#dc2626', '#b91c1c', '#991b1b'],
            neutral: ['#6b7280', '#4b5563', '#374151', '#1f2937']
        };

        // Enhanced chart styling options
        const chartOptions = {
            responsive: true,
            maintainAspectRatio: false,
            interaction: {
                mode: 'index',
                intersect: false,
            },
            plugins: {
                legend: {
                    display: true,
                    position: 'top',
                    align: 'center',
                    labels: {
                        usePointStyle: true,
                        pointStyle: 'circle',
                        padding: 25,
                        font: {
                            size: 13,
                            weight: '600',
                            family: 'Inter'
                        },
                        color: '#374151'
                    }
                },
                tooltip: {
                    enabled: true,
                    backgroundColor: 'rgba(0, 0, 0, 0.9)',
                    titleFont: { 
                        size: 14, 
                        weight: '600',
                        family: 'Inter'
                    },
                    bodyFont: { 
                        size: 12,
                        family: 'Inter'
                    },
                    cornerRadius: 12,
                    padding: 16,
                    displayColors: true,
                    borderColor: 'rgba(255, 255, 255, 0.1)',
                    borderWidth: 1,
                    titleColor: '#ffffff',
                    bodyColor: '#e5e7eb',
                    callbacks: {
                        labelColor: function(context) {
                            return {
                                borderColor: context.dataset.borderColor,
                                backgroundColor: context.dataset.backgroundColor
                            };
                        }
                    }
                }
            },
            scales: {
                x: {
                    display: true,
                    grid: {
                        display: true,
                        color: 'rgba(0, 0, 0, 0.05)',
                        drawBorder: false
                    },
                    ticks: {
                        font: {
                            size: 11,
                            weight: '500',
                            family: 'Inter'
                        },
                        color: '#6b7280',
                        maxRotation: 45
                    },
                    border: {
                        display: false
                    }
                },
                y: {
                    beginAtZero: true,
                    display: true,
                    grid: {
                        display: true,
                        color: 'rgba(0, 0, 0, 0.05)',
                        drawBorder: false
                    },
                    ticks: {
                        font: {
                            size: 11,
                            weight: '500',
                            family: 'Inter'
                        },
                        color: '#6b7280',
                        callback: function(value, index, values) {
                            // Format large numbers with K, M suffixes
                            if (value >= 1000000) {
                                return 'Tk ' + (value / 1000000).toFixed(1) + 'M';
                            } else if (value >= 1000) {
                                return 'Tk ' + (value / 1000).toFixed(0) + 'K';
                            }
                            return 'Tk ' + value;
                        }
                    },
                    border: {
                        display: false
                    }
                }
            },
            elements: {
                point: {
                    radius: 4,
                    hoverRadius: 8,
                    borderWidth: 2,
                    hoverBorderWidth: 3
                },
                line: {
                    borderWidth: 3,
                    tension: 0.4
                }
            }
        };

        // Sales & Orders Trend Chart
        const salesOrdersCtx = document.getElementById('salesOrdersChart').getContext('2d');
        new Chart(salesOrdersCtx, {
            type: 'line',
            data: {
                labels: {{ sales_labels|safe }},
                datasets: [{
                    label: 'Sales Revenue (Tk)',
                    data: {{ sales_data|safe }},
                    borderColor: colorPalette.primary[0],
                    backgroundColor: colorPalette.primary[0] + '15',
                    borderWidth: 3,
                    fill: true,
                    tension: 0.4,
                    pointBackgroundColor: colorPalette.primary[0],
                    pointBorderColor: '#ffffff',
                    pointBorderWidth: 2,
                    pointRadius: 5,
                    pointHoverRadius: 8
                }, {
                    label: 'Order Count',
                    data: {{ orders_data|safe }},
                    borderColor: colorPalette.secondary[0],
                    backgroundColor: colorPalette.secondary[0] + '15',
                    borderWidth: 3,
                    fill: true,
                    tension: 0.4,
                    pointBackgroundColor: colorPalette.secondary[0],
                    pointBorderColor: '#ffffff',
                    pointBorderWidth: 2,
                    pointRadius: 5,
                    pointHoverRadius: 8,
                    yAxisID: 'y1'
                }]
            },
            options: {
                ...chartOptions,
                scales: {
                    ...chartOptions.scales,
                    y1: {
                        type: 'linear',
                        display: true,
                        position: 'right',
                        beginAtZero: true,
                        grid: {
                            drawOnChartArea: false,
                        },
                        ticks: {
                            font: {
                                size: 11,
                                weight: '500',
                                family: 'Inter'
                            },
                            color: '#6b7280'
                        },
                        border: {
                            display: false
                        }
                    }
                }
            }
        });

        // Category Performance Doughnut Chart
        const categoryCtx = document.getElementById('categoryChart').getContext('2d');
        new Chart(categoryCtx, {
            type: 'doughnut',
            data: {
                labels: {{ category_labels|safe }},
                datasets: [{
                    data: {{ category_sales_data|safe }},
                    backgroundColor: [
                        colorPalette.primary[0],
                        colorPalette.secondary[0],
                        colorPalette.accent[0],
                        colorPalette.warning[0],
                        colorPalette.error[0],
                        colorPalette.neutral[0],
                        colorPalette.primary[1],
                        colorPalette.secondary[1]
                    ],
                    borderColor: '#ffffff',
                    borderWidth: 3,
                    hoverBorderWidth: 4,
                    hoverOffset: 10
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                cutout: '60%',
                plugins: {
                    legend: {
                        display: true,
                        position: 'bottom',
                        labels: {
                            usePointStyle: true,
                            pointStyle: 'circle',
                            padding: 20,
                            font: {
                                size: 12,
                                weight: '600',
                                family: 'Inter'
                            },
                            color: '#374151'
                        }
                    },
                    tooltip: {
                        backgroundColor: 'rgba(0, 0, 0, 0.9)',
                        titleFont: { size: 14, weight: '600', family: 'Inter' },
                        bodyFont: { size: 12, family: 'Inter' },
                        cornerRadius: 12,
                        padding: 16,
                        callbacks: {
                            label: function(context) {
                                const value = context.parsed;
                                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                const percentage = ((value / total) * 100).toFixed(1);
                                return context.label + ': Tk ' + value.toLocaleString() + ' (' + percentage + '%)';
                            }
                        }
                    }
                },
                animation: {
                    animateRotate: true,
                    duration: 1000
                }
            }
        });

        // Monthly Revenue Trend Chart
        const monthlyRevenueCtx = document.getElementById('monthlyRevenueChart').getContext('2d');
        new Chart(monthlyRevenueCtx, {
            type: 'bar',
            data: {
                labels: {{ monthly_labels|safe }},
                datasets: [{
                    label: 'Monthly Revenue (Tk)',
                    data: {{ monthly_data|safe }},
                    backgroundColor: colorPalette.primary[0] + '90',
                    borderColor: colorPalette.primary[0],
                    borderWidth: 2,
                    borderRadius: 8,
                    borderSkipped: false,
                    hoverBackgroundColor: colorPalette.primary[1],
                    hoverBorderColor: colorPalette.primary[1]
                }]
            },
            options: {
                ...chartOptions,
                plugins: {
                    ...chartOptions.plugins,
                    tooltip: {
                        ...chartOptions.plugins.tooltip,
                        callbacks: {
                            label: function(context) {
                                return 'Revenue: Tk ' + context.parsed.y.toLocaleString();
                            }
                        }
                    }
                }
            }
        });

        // Order Status Distribution Pie Chart
        const orderStatusCtx = document.getElementById('orderStatusChart').getContext('2d');
        new Chart(orderStatusCtx, {
            type: 'pie',
            data: {
                labels: {{ status_labels|safe }},
                datasets: [{
                    data: {{ status_data|safe }},
                    backgroundColor: [
                        colorPalette.secondary[0], // Completed - green
                        colorPalette.warning[0],   // Processing - orange
                        colorPalette.primary[0],   // New - blue
                        colorPalette.error[0],     // Cancelled - red
                        colorPalette.neutral[0]    // Other - gray
                    ],
                    borderColor: '#ffffff',
                    borderWidth: 3,
                    hoverBorderWidth: 4,
                    hoverOffset: 8
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: true,
                        position: 'bottom',
                        labels: {
                            usePointStyle: true,
                            pointStyle: 'circle',
                            padding: 20,
                            font: {
                                size: 12,
                                weight: '600',
                                family: 'Inter'
                            },
                            color: '#374151'
                        }
                    },
                    tooltip: {
                        backgroundColor: 'rgba(0, 0, 0, 0.9)',
                        titleFont: { size: 14, weight: '600', family: 'Inter' },
                        bodyFont: { size: 12, family: 'Inter' },
                        cornerRadius: 12,
                        padding: 16,
                        callbacks: {
                            label: function(context) {
                                const value = context.parsed;
                                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                const percentage = ((value / total) * 100).toFixed(1);
                                return context.label + ': ' + value + ' orders (' + percentage + '%)';
                            }
                        }
                    }
                },
                animation: {
                    animateRotate: true,
                    duration: 1000
                }
            }
        });

        // Top 5 Products by Revenue Horizontal Bar Chart
        const topProductsCtx = document.getElementById('topProductsChart').getContext('2d');

        // Define a color palette for 5 bars
        const barColors = ['#3b82f6', '#10b981', '#f59e0b', '#8b5cf6', '#ef4444'];

        // Slice only top 5 products
        const topLabels = {{ top_product_labels|safe }}.slice(0, 5);
        const topData = {{ top_product_revenue_data|safe }}.slice(0, 5);

        new Chart(topProductsCtx, {
            type: 'bar',
            data: {
                labels: topLabels,
                datasets: [{
                    label: 'Revenue (Tk)',
                    data: topData,
                    backgroundColor: barColors.map(c => c + '90'), // semi-transparent
                    borderColor: barColors,
                    borderWidth: 2,
                    borderRadius: 6,
                    borderSkipped: false,
                    hoverBackgroundColor: barColors,
                    hoverBorderColor: barColors
                }]
            },
            options: {
                ...chartOptions,
                indexAxis: 'y',
                scales: {
                    x: {
                        beginAtZero: true,
                        display: true,
                        grid: {
                            display: true,
                            color: 'rgba(0, 0, 0, 0.05)',
                            drawBorder: false
                        },
                        ticks: {
                            font: { size: 11, weight: '500', family: 'Inter' },
                            color: '#6b7280',
                            callback: function(value) {
                                if (value >= 1000000) return 'Tk ' + (value / 1000000).toFixed(1) + 'M';
                                else if (value >= 1000) return 'Tk ' + (value / 1000).toFixed(0) + 'K';
                                return 'Tk ' + value;
                            }
                        },
                        border: { display: false }
                    },
                    y: {
                        display: false, // hide product names on the y-axis
                        grid: { display: false }
                    }
                },
                plugins: {
                    ...chartOptions.plugins,
                    legend: {
                        display: true,
                        position: 'bottom',
                        align: 'center',
                        labels: {
                            generateLabels: function(chart) {
                                return chart.data.labels.map((label, i) => ({
                                    text: label,
                                    fillStyle: chart.data.datasets[0].backgroundColor[i],
                                    strokeStyle: chart.data.datasets[0].borderColor[i],
                                    index: i
                                }));
                            },
                            font: { size: 12, weight: '600', family: 'Inter' },
                            color: '#374151',
                            boxWidth: 20,
                            padding: 15
                        }
                    },
                    tooltip: {
                        ...chartOptions.plugins.tooltip,
                        callbacks: {
                            label: function(context) {
                                return 'Revenue: Tk ' + context.parsed.x.toLocaleString();
                            }
                        }
                    }
                }
            }
        });


        // Customer Acquisition Line Chart
        const customerAcquisitionCtx = document.getElementById('customerAcquisitionChart').getContext('2d');
        new Chart(customerAcquisitionCtx, {
            type: 'line',
            data: {
                labels: {{ customer_labels|safe }},
                datasets: [{
                    label: 'New Customers',
                    data: {{ customer_data|safe }},
                    borderColor: colorPalette.secondary[0],
                    backgroundColor: colorPalette.secondary[0] + '20',
                    borderWidth: 3,
                    fill: true,
                    tension: 0.4,
                    pointBackgroundColor: colorPalette.secondary[0],
                    pointBorderColor: '#ffffff',
                    pointBorderWidth: 3,
                    pointRadius: 6,
                    pointHoverRadius: 10,
                    pointHoverBorderWidth: 4
                }]
            },
            options: {
                ...chartOptions,
                scales: {
                    ...chartOptions.scales,
                    y: {
    beginAtZero: true,
    ticks: {
        stepSize: 1,
        callback: function (value) {
            if (!Number.isFinite(value)) return ''; // skip invalid ticks
            return value + ' ' + (value <= 1 ? 'customer' : 'customers');
        }
    }
}

                },
                plugins: {
                    ...chartOptions.plugins,
                    tooltip: {
                        ...chartOptions.plugins.tooltip,
                        callbacks: {
                            label: function(context) {
                                return 'New Customers: ' + context.parsed.y;
                            }
                        }
                    }
                }
            }
        });


        // Add loading animation effect
        document.addEventListener('DOMContentLoaded', function() {
            const charts = document.querySelectorAll('.chart-container canvas');
            charts.forEach((chart, index) => {
                chart.style.opacity = '0';
                chart.style.transform = 'scale(0.8)';
                setTimeout(() => {
                    chart.style.transition = 'all 0.8s cubic-bezier(0.4, 0, 0.2, 1)';
                    chart.style.opacity = '1';
                    chart.style.transform = 'scale(1)';
                }, index * 200);
            });
        });

        // Smooth scroll for any anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // Add subtle parallax effect to header
        window.addEventListener('scroll', () => {
            const scrolled = window.pageYOffset;
            const header = document.querySelector('.gradient-bg');
            if (header) {
                header.style.transform = `translateY(Tk {scrolled * 0.3}px)`;
            }
        });

    </script>

</body>
</html>